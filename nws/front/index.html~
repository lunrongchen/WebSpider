<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>群体事件地图展示</title>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="css/font-awesome.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link href="css/pages/dashboard.css" rel="stylesheet">
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=uZUxQ6aCPUE3fHeHYYtDqgCj"></script>
<script type ="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script><style>
#mapx{position:relative;height:550px; width:820px;margin:20px;border:20px;}
</style>
<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
    <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span> </a>
    <a class="brand" href="index.html">群体事件</a>
      <div class="nav-collapse">
        <ul class="nav pull-right">
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                            class="icon-cog"></i> 账户 <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:;">设置</a></li>
              <li><a href="javascript:;">帮助</a></li>
            </ul>
          </li>
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                            class="icon-user"></i> yuqing.com <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:;">主页</a></li>
              <li><a href="javascript:;">退出</a></li>
            </ul>
          </li>
        </ul>
        <form class="navbar-search pull-right">
          <input type="text" class="search-query" placeholder="Search">
        </form>
      </div>
      <!--/.nav-collapse --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /navbar-inner --> 
</div>
<!-- /navbar -->
<div class="subnavbar">
  <div class="subnavbar-inner">
    <div class="container">
      <ul class="mainnav">
        <li class="active"><a href="index.html"><i class="icon-dashboard"></i><span>地图</span> </a> </li>
        <li><a href="reports.html"><i class="icon-list-alt"></i><span>报告</span> </a> </li>
        <li><a href="charts.html"><i class="icon-bar-chart"></i><span>图表分析</span> </a> </li>
      </ul>
    </div>
    <!-- /container --> 
  </div>
  <!-- /subnavbar-inner --> 
</div>
<!-- /subnavbar -->
<div class="main">
  <div class="main-inner">
    <div class="container">
      <div class="row">
        <div class="span9">
          <div class="widget widget-nopad">
            <div class="widget-header"> <i class="icon-list-alt"></i>
              <h3> Baidu API 地图</h3>
            </div>
            <!-- /widget-header -->
            <div class="widget-content">
              <div class="widget big-stats-container">
                <div class="widget-content">
                  <h6 class="bigstats">以下是群体性事件发生地点在百度地图上的显示</h6>
                  	<!--<canvas id="area-chart" class="chart-holder" height="600" width="700">--> 
                    <div id="big_stats" class="cf">
                     <div id="mapx"></div>
                  </div>
                </div>
                <!-- /widget-content --> 
                
              </div>
            </div>
          </div>
          <!-- /widget -->
        </div>
        <!-- /span6 -->
        <div class="span3">
          <div class="widget">
            <div class="widget-header"> <i class="icon-bookmark"></i>
              <h3>选择时间</h3>
           </div>
            <!-- /widget-header -->
            <div class="widget-content">
             <div class="shortcuts">
              <h4>开始时间：</h4> <input type="date" id="s1"/>
              <h4>结束时间：</h4> <input type="date" id="e1" /> 
            <button type="button" class="btn btn-inverse" onclick="func()">
               确定
            </button>
              </div>
            </div>
            <!-- /widget-content --> 
          </div>
          <!-- /widget -->
          <div class="widget">
            <div class="widget-header"> <i class="icon-signal"></i>
              <h3>图表</h3>
            </div>
            <!-- /widget-header -->
            <div class="widget-content">
              
              <!-- /area-chart --> 
            </div>
            <!-- /widget-content --> 
          </div>
          <!-- /widget -->
          
          <div class="widget widget-nopad">
            <div class="widget-header"> <i class="icon-list-alt"></i>
              <h3>最新信息</h3>
            </div>
            <!-- /widget-header -->
            <div class="widget-content">
            
            </div>
            <!-- /widget-content --> 
          </div>
          <!-- /widget -->
        </div>
        <!-- /span3 --> 
      </div>
      <!-- /row --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /main-inner --> 
</div>
<!-- /main -->
<div class="extra">
  <div class="extra-inner">
    <div class="container">
      <div class="row">
                    <div class="span3">
                        <h4>
                           关于我们</h4>
                        <ul>
                            <li><a href="javascript:;">yuqing.com</a></li>
                            <li><a href="javascript:;">网页开发</a></li>
                 
                        </ul>
                    </div>
                    <!-- /span3 -->
                    <div class="span3">
                        <h4>
                            支持</h4>
                        <ul>
                            <li><a href="javascript:;">FAQ</a></li>
                            <li><a href="javascript:;">联系邮箱</a></li>
                            <li><a href="javascript:;">反馈</a></li>
                        </ul>
                    </div>
                    <!-- /span3 -->
                    <div class="span3">
                        <h4>声明</h4>
                        <ul>
                            <li><a href="javascript:;"></a></li>
                            <li><a href="javascript:;"></a></li>
                            <li><a href="javascript:;"></a></li>
                        </ul>
                    </div>
                    <!-- /span3 -->
                    <div class="span3">
                        <h4>
                            开源插件</h4>
                        <ul>
                            <li><a href="http://sc.chinaz.com">Open Source jQuery Plugins</a></li>
                            <li><a href="http://sc.chinaz.com;">HTML5 Responsive Tempaltes</a></li>
                            <li><a href="http://sc.chinaz.com;">Free Contact Form Plugin</a></li>
                            <li><a href="http://sc.chinaz.com;">Flat UI PSD</a></li>
                        </ul>
                    </div>
                    <!-- /span3 -->
                </div>
      <!-- /row --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /extra-inner --> 
</div>
<!-- /extra -->
<div class="footer">
  <div class="footer-inner">
    <div class="container">
      <div class="row">
        <div class="span12"> &copy; 2015 <a href="http://sc.chinaz.com/"><span>BDCCL</span></a>. </div>
        <!-- /span12 --> 
      </div>
      <!-- /row --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /footer-inner --> 
</div>
<!-- /footer --> 
<!-- Le javascript
================================================== --> 
<!-- Placed at the end of the document so the pages load faster --> 
<script src="js/jquery-1.9.0.js"></script> 
<script src="js/excanvas.min.js"></script> 
<script src="js/chart.min.js" type="text/javascript"></script> 
<script src="js/bootstrap.js"></script> 
<script src="js/base.js"></script> 

</body>
</html>
<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("mapx");          
	  map.centerAndZoom(new BMap.Point(116.404, 39.915), 8);
    map.enableScrollWheelZoom();//start the wheel to scale
    map.enableContinuousZoom();//start drag
    //map1.setMapStyle({style:'grayscale'});
    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.OverviewMapControl());

    map.addControl(new BMap.OverviewMapControl({
      isOpen:true,
      anchor:BMAP_ANCHOR_BOTTOM_RIGHT
    }));
    
    var myGeo = new BMap.Geocoder();
    var myIcon = new BMap.Icon("/images/pin.png", new BMap.Size(32,32));
    
    
    var start = "2015-04-17";
    var end = "2015-04-19";

    function func(){
        //bdGEO();
        $.getJSON(
            'http://localhost/server/post.php', 
            {name:'allen', startTime: start, endTime: end}, 
            function(data){
                console.log(data);
            }
        );
        start = $("#s1").val();
        end = $("#e1").val();
        console.log(start, end);

        $.getJSON('http://localhost/server/test.php',
            {startTime: start, endTime: end}, 
            function(xdata){
                data = xdata['data'];
                for ( var idx =0; idx < data.length; idx++ ){
                    //console.log( data[idx].title, data[idx].location );
                    console.log(data[idx]);
                    (function(obj){myGeo.getPoint( obj.location, function(point){
                        if (point){
                            var addr = new BMap.Point(point.lng, point.lat);
                            addMarker2( addr, obj );
                        }
                    }, "中国");})(data[idx]);
                }
            })
    }
    
    function buildInfo( obj ){
        console.log(obj);
        head = '<h2>' + obj.location + '</h2>';
        title = '<h4>' + obj.title + '</h4>';
        body = '<p>' + obj.content + '<p>';
        return head + title+ body;
    }
    
    function addMarker2( point , obj ){
        var marker = new BMap.Marker(point, {icon:myIcon, offset:new BMap.Size(0, -16)});
        map.addOverlay(marker);
        
        var win = new BMap.InfoWindow( buildInfo( obj ) );
        
        marker.addEventListener('click', function(){
            this.openInfoWindow(win);
        })
    }
     /*var getJSON = function(url, successHandler, errorHandler) {
        var xhr = new XMLHttpRequest();
        xhr.open('get', url, true);
        xhr.responseType = 'json';
        xhr.onload = function() {
        var status = xhr.status;
    if (status == 200) {
      successHandler && successHandler(xhr.response);
    } else {
      errorHandler && errorHandler(status);
    }
  };
  xhr.send();
};

getJSON('https://mathiasbynens.be/demo/ip', function(data) {
  alert('Your public IP address is: ' + data.title);
}, function(status) {
  alert('Something went wrong.');
});*/
/*    $(function(){   
    $("#btn").bind("click",{btn:$("#btn")},function(evdata){      
         $.ajax({      
                type:"POST",      
                dataType:"json",      
                url:"http://localhost/server/post.php",      
                timeout:80000,     //ajax请求超时时间80秒      
                data:{time:"80"}, //40秒后无论结果服务器都返回数据      
                success:function(data,textStatus){      
                    //从服务器得到数据，显示数据并继续查询      
                    if(data.success=="1"){      
                     $("#msg").append("<br>[有数据]"+data.text);      
                     evdata.data.btn.click();      
                    }      
                 //未从服务器得到数据，继续查询      
                    if(data.success=="0"){      
                    $("#msg").append("<br>[无数据]");      
                    evdata.data.btn.click();      
                    }      
                },      
             //Ajax请求超时，继续查询      
             error:function(XMLHttpRequest,textStatus,errorThrown){      
                     if(textStatus=="timeout"){      
                         $("#msg").append("<br>[超时]");      
                         evdata.data.btn.click();      
                     }      
             }      
                      
            });      
    });      
          
});
    function func1(){
        //bdGEO();
       $.getJSON(
            'http://localhost/server/post.php', 
            {name:'allen', startTime: start, endTime: end}, 
            function(data){
                console.log(data);
            }
        );
        start = $("#s1").val();
        console.log("hello1");
        end = $("#e1").val();
        console.log(start, end);
        $.getJSON('http://localhost/server/test.php',
            {startTime: start, endTime: end}, 
            function(xdata){
                data = xdata['data'];
                for ( var idx =0; idx < data.length; idx++ ){
                    //console.log( data[idx].title, data[idx].location );
                    console.log(data[idx]);
                    (function(obj){myGeo.getPoint( obj.location, function(point){
                        if (point){
                            var addr = new BMap.Point(point.lng, point.lat);
                            addMarker2( addr, obj );
                        }
                    }, "中国");})(data[idx]);
                }
            })
    }*/
</script>
